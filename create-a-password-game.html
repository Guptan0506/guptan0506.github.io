<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Password Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        #password-input {
            font-family: 'JetBrains Mono', monospace;
        }
        .rule-item {
            transition: all 0.3s ease-in-out;
            transform-origin: top;
        }
        .rule-satisfied {
            background-color: rgba(4, 120, 87, 0.1); /* bg-emerald-900 with opacity */
            border-color: rgba(16, 185, 129, 0.4); /* border-emerald-500 with opacity */
        }
         .rule-unsatisfied {
            background-color: rgba(127, 29, 29, 0.1); /* bg-red-900 with opacity */
            border-color: rgba(239, 68, 68, 0.4); /* border-red-500 with opacity */
        }
        .rule-hidden {
            opacity: 0;
            transform: scaleY(0);
            height: 0;
            margin: 0;
            padding: 0;
            border: 0;
        }
        .checkmark, .crossmark {
            transition: transform 0.2s ease;
        }
        .rule-satisfied .crossmark, .rule-unsatisfied .checkmark {
            transform: scale(0);
            display: none;
        }
        .rule-satisfied .checkmark, .rule-unsatisfied .crossmark {
            transform: scale(1);
            display: inline-block;
        }
        .home-button {
            padding: 12px 20px;
            border-radius: 8px;
            border: none;
            font-weight: 700;
            cursor: pointer;
            color: #4f46e5;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-2xl mx-auto">
        <h1 class="text-3xl md:text-4xl font-bold text-center mb-2 text-white">The Password Game</h1>
        <p class="text-center text-gray-400 mb-8">Please choose a password.</p>

        <div class="relative">
            <input type="text" id="password-input" class="w-full p-4 bg-gray-800 border-2 border-gray-700 rounded-lg text-lg text-white focus:outline-none focus:border-cyan-500 transition-colors" placeholder="••••••••••••" autocomplete="off">
        </div>

        <div id="rules-container" class="mt-8 space-y-3">
            <!-- Rules will be dynamically inserted here -->
        </div>

        <div id="win-message" class="hidden mt-8 text-center p-6 bg-emerald-900/50 border-2 border-emerald-500/70 rounded-lg">
            <h2 class="text-2xl font-bold text-emerald-300">🎉 Congratulations! 🎉</h2>
            <p class="text-emerald-200 mt-2">You have forged the ultimate password and satisfied all the rules. The digital realm is now secure.</p>
        </div>

        <!--To go back home-->
        <div class="home-button">
            <button><a href="index.html">Want to go back to my personal portfolio?</a></button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const passwordInput = document.getElementById('password-input');
            const rulesContainer = document.getElementById('rules-container');
            const winMessage = document.getElementById('win-message');
            
            let paulInterval; // For our chicken friend

            // --- Helper Functions ---
            const getDigitsSum = (str) => {
                const digits = str.match(/\d/g) || [];
                return digits.map(Number).reduce((a, b) => a + b, 0);
            };

            const containsRomanNumeral = (str) => {
                 return /[IVXLCDM]/i.test(str);
            };
            
            const getRomanProduct = (str) => {
                const romanNumerals = str.match(/(?:[IVXLCDM]+)/gi) || [];
                if (romanNumerals.length === 0) return 0;
                
                const romanMap = { 'I': 1, 'V': 5, 'X': 10, 'L': 50, 'C': 100, 'D': 500, 'M': 1000 };
                let product = 1;
                
                // Super simplified parser for the game's purpose
                const parseRoman = (roman) => {
                    let total = 0;
                    for (let i = 0; i < roman.length; i++) {
                        const current = romanMap[roman[i].toUpperCase()];
                        const next = romanMap[roman[i + 1]?.toUpperCase()];
                        if (next && current < next) {
                            total -= current;
                        } else {
                            total += current;
                        }
                    }
                    return total;
                };

                romanNumerals.forEach(r => {
                    product *= parseRoman(r);
                });
                return product;
            };

            // Calculate moon phase. Returns an emoji.
            const getMoonPhase = () => {
                const LUNAR_CYCLE = 29.530588853;
                const getJulianDate = (date = new Date()) => {
                    const time = date.getTime();
                    const tzoffset = date.getTimezoneOffset();
                    return (time / 86400000) - (tzoffset / 1440) + 2440587.5;
                }
                const knownNewMoon = getJulianDate(new Date(2000, 0, 6));
                const today = getJulianDate();
                const age = (today - knownNewMoon) % LUNAR_CYCLE;
                
                if (age < 1.84566) return '🌑'; // New Moon
                if (age < 5.53699) return '🌒'; // Waxing Crescent
                if (age < 9.22831) return '🌓'; // First Quarter
                if (age < 12.91963) return '🌔'; // Waxing Gibbous
                if (age < 16.61096) return '🌕'; // Full Moon
                if (age < 20.30228) return '🌖'; // Waning Gibbous
                if (age < 23.99361) return '🌗'; // Last Quarter
                if (age < 27.68493) return '🌘'; // Waning Crescent
                return '🌑'; // New Moon
            };
            
            const captcha = Math.random().toString(36).substring(2, 8).toUpperCase();
            const wordleAnswer = "QUERY"; // Hardcoded for consistency

            // --- Game Rules Definition ---
            let rules = [
                { id: 1, text: "Your password must be at least 5 characters.", validator: (p) => p.length >= 5 },
                { id: 2, text: "Your password must include a number.", validator: (p) => /\d/.test(p) },
                { id: 3, text: "Your password must include an uppercase letter.", validator: (p) => /[A-Z]/.test(p) },
                { id: 4, text: "Your password must include a special character.", validator: (p) => /[!@#$%^&*()]/.test(p) },
                { id: 5, text: "The digits in your password must add up to 25.", validator: (p) => getDigitsSum(p) === 25 },
                { id: 6, text: "Your password must include a month of the year.", validator: (p) => /(January|February|March|April|May|June|July|August|September|October|November|December)/i.test(p) },
                { id: 7, text: "Your password must include a Roman numeral.", validator: (p) => containsRomanNumeral(p) },
                { id: 8, text: "Your password must include one of our sponsors: Pepsi, Starbucks, or Shell.", validator: (p) => /(pepsi|starbucks|shell)/i.test(p) },
                { id: 9, text: "The Roman numerals in your password must multiply to 35.", validator: (p) => getRomanProduct(p) === 35 },
                { id: 10, text: `Your password must include this CAPTCHA: <span class="font-bold text-cyan-300 bg-gray-700 px-2 py-1 rounded">${captcha}</span>`, validator: (p) => p.includes(captcha) },
                { id: 11, text: `Your password must include today's Wordle answer: <span class="font-bold text-emerald-300">${wordleAnswer}</span>`, validator: (p) => p.includes(wordleAnswer) },
                { id: 12, text: `Your password must include the current phase of the moon as an emoji: ${getMoonPhase()}`, validator: (p) => p.includes(getMoonPhase()) },
                { id: 13, text: 'Your password must include the name of this country: <img src="https://placehold.co/400x200/000000/FFFFFF?text=Guess+The+Country" onerror="this.onerror=null; this.src=\'https://placehold.co/400x200/000000/FFFFFF?text=Image+Error\'" alt="A street view of a location in Egypt" class="rounded-md my-2 border-2 border-gray-600"><p class="text-sm text-gray-400 -mt-1">Hint: It\'s famous for pyramids.</p>', validator: (p) => p.toLowerCase().includes("egypt") },
                { id: 14, text: `🥚 This is my chicken Paul. Please put him in your password and keep him safe.`, validator: (p) => p.includes("🥚"), onSatisfied: () => {
                     // When Paul is first added, he might get into trouble later...
                     // A fire might start, for instance. We'll add that rule dynamically.
                     const fireRule = rules.find(r => r.id === 15);
                     if (fireRule && !fireRule.isShown) {
                         setTimeout(() => {
                             if (!passwordInput.value.includes('🔥')) {
                                passwordInput.value += '🔥';
                                validatePassword();
                             }
                         }, 2000);
                     }
                }},
                { id: 15, text: `<span class="text-red-400 font-bold">Oh no! Your password is on fire 🔥. Quick, put it out!</span>`, validator: (p) => !p.includes("🔥") },
                { id: 16, text: `Paul has hatched! 🐔 Please don't forget to feed him. He eats three 🐛.`, validator: (p) => (p.match(/🐛/g) || []).length >= 3, onSatisfied: () => {
                    // Paul eats the worms
                    setTimeout(() => {
                        passwordInput.value = passwordInput.value.replace(/🐛/g, '');
                        validatePassword();
                    }, 1500);
                }},
            ];
            
            // Initialize state
            rules.forEach((rule, index) => {
                rule.isSatisfied = false;
                rule.isShown = index === 0; // Show only the first rule initially
                rule.element = null; // To store the DOM element
            });

            const renderRules = () => {
                rules.forEach(rule => {
                    if (rule.isShown && !rule.element) {
                        const ruleEl = document.createElement('div');
                        ruleEl.className = 'rule-item p-4 border-2 rounded-lg flex items-start space-x-4 rule-unsatisfied';
                        ruleEl.innerHTML = `
                            <div class="flex-shrink-0 pt-1">
                                <span class="checkmark text-emerald-400">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg>
                                </span>
                                <span class="crossmark text-red-400">
                                     <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                                </span>
                            </div>
                            <p class="flex-grow text-gray-300">Rule ${rule.id}: ${rule.text}</p>
                        `;
                        rulesContainer.appendChild(ruleEl);
                        rule.element = ruleEl;
                    }
                    
                    if (rule.element) {
                        if (rule.isSatisfied) {
                            rule.element.classList.add('rule-satisfied');
                            rule.element.classList.remove('rule-unsatisfied');
                        } else {
                            rule.element.classList.remove('rule-satisfied');
                            rule.element.classList.add('rule-unsatisfied');
                        }
                    }
                });
            };
            
            const validatePassword = () => {
                const password = passwordInput.value;
                let allShownRulesSatisfied = true;
                let lastShownRuleIndex = -1;

                rules.forEach((rule, index) => {
                    if (rule.isShown) {
                        const wasSatisfied = rule.isSatisfied;
                        rule.isSatisfied = rule.validator(password);

                        if (rule.isSatisfied && !wasSatisfied && rule.onSatisfied) {
                            rule.onSatisfied();
                        }
                        
                        if (!rule.isSatisfied) {
                            allShownRulesSatisfied = false;
                        }
                        lastShownRuleIndex = index;
                    }
                });
                
                // If all visible rules are met, show the next one
                if (allShownRulesSatisfied) {
                    const nextRule = rules[lastShownRuleIndex + 1];
                    if (nextRule) {
                        nextRule.isShown = true;
                    } else {
                        // All rules are satisfied
                        winMessage.classList.remove('hidden');
                    }
                }
                
                renderRules();
            };

            // Initial render
            renderRules();
            
            passwordInput.addEventListener('input', validatePassword);
        });
    </script>
</body>
</html>
